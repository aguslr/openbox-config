#
# These things are run when an Openbox X Session is started.
#

# Use different git branch depending on screen height
if [ "$(xdpyinfo | awk '/dimensions/ {print $2}' | awk -Fx '{print $2}')" -lt 800 ]; then
	(cd "${XDG_CONFIG_HOME:-$HOME/.config}/openbox" && \
		git checkout maximized 2>/dev/null && openbox --reconfigure)
else
	(cd "${XDG_CONFIG_HOME:-$HOME/.config}/openbox" && \
		git checkout master 2>/dev/null && openbox --reconfigure)
fi

# Configure monitors
disper --resolution=auto --extend

# Set X Server properties
xrdb ~/.Xdefaults

# Load color profile
xcalib -d :0 ~/.color/icc/screen0.icm 2>/dev/null
xcalib -d :1 ~/.color/icc/screen1.icm 2>/dev/null

# Load custom Xmodmap
[ -f "$HOME/.Xmodmap" ] && xmodmap "$HOME/.Xmodmap"

# Bind Caps Lock to Ctrl when held
setxkbmap -option caps:ctrl_modifier

# Enable trackpad tapping, edgescrolling and disable while typing
synclient TapButton1=1 TapButton2=2 TapButton3=3 HorizEdgeScroll=1 VertEdgeScroll=1 PalmDetect=1

# Hide mouse cursor when not used
unclutter -root -visible -noevents &

# Start sxhkd
sxhkd -c "${XDG_CONFIG_HOME:-$HOME/.config}/sxhkd/sxhkdrc" &

# Start Terminal daemon
pgrep -xu "$USER" urxvtd >/dev/null || urxvtd -q -o -f

# Generate color files
getXcolor.sh --generate all

# Set background
bgcolor="$(getXcolor.sh -c white 2>/dev/null)"       || bgcolor='1c1c1c'
fgcolor="$(getXcolor.sh -c brightblack 2>/dev/null)" || fgcolor='7f7f7f'
xsetroot -bg "#$bgcolor" -fg "#$fgcolor" -mod 2 2

# Launch panel
tint2 -c "${XDG_CONFIG_HOME:-$HOME/.config}/tint2/ob_taskbar" &
# Launch systray
tint2 -c "${XDG_CONFIG_HOME:-$HOME/.config}/tint2/ob_systray" &

# Set DPMS (Energy Star) features
xset dpms 630 700 760
# Change screen timeout
# https://wiki.archlinux.org/index.php/Display_Power_Management_Signaling#Modifying_DPMS_and_screensaver_settings_using_xset
xset s 600
# Start xss-lock if login locally
if [ -z "$XRDP_SESSION" ]; then
	pgrep -xu "$USER" xss-lock >/dev/null || \
	    xss-lock -- i3lock.sh -efI 5 &
fi

# Start udiskie for device automonting
pgrep -xu "$USER" udiskie >/dev/null || udiskie --smart-tray &

# Set volume to 50%
amixer -q sset Master 50%

# Start fdpowermon
fdpowermon &

# Load local configuration
# shellcheck source=/dev/null
[ -r "${XDG_CONFIG_HOME:-$HOME/.config}/openbox/autostart.local" ] && \
	. "${XDG_CONFIG_HOME:-$HOME/.config}/openbox/autostart.local"


# vim: set ft=sh :
